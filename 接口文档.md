# 接口文档

## 约定

- 若请求头一栏为 `/`，则说明不需要请求头。若请求头一栏为"认证"，则说明需要在请求头封装token数据
- 所有后端成功返回的数据均为以下形式。若无特别说明，后面所指的响应均为 `data` 中的数据类型。实现中使用通用返回值 `Result<T>`，成功时 `code` 为 `1`，失败时 `code` 为 `0`；成功/失败的信息放在 `msg` 字段，具体数据放在 `data` 字段（无数据时为 `null`）。
    ```json
    {
        "code": 1,
        "msg": "成功消息或提示",
        "data": /* 具体数据，无数据时为 null */
    }
    ```

- 所有后端返回失败的数据也遵循同一格式（失败时 `code` 为 0）：
    ```json
    {
        "code": 0,
        "msg": "错误原因",
        "data": null
    }
    ```

## 登录与验证

### 管理员登录 POST /admin/login

- 请求头：无需认证
- 请求体（JSON）：
    ```json
    {
        "id": "管理员id",
        "userName": "管理员账号",
        "userPassword": "管理员密码"
    }
    ```
    说明：`id` 或 `userName` 二选一（支持ID登录或账号登录）
- 响应：`Result<String>`，成功时 `data` 为 token

### 管理员登出 POST /admin/logout

- 请求头：认证
- 响应：`Result<Void>`

### 验证令牌 GET /admin/authorization

- 请求头：认证
- 响应：`Result<Void>`

### 修改密码 PUT /admin/password

- 请求头：认证
- 请求体（JSON）：
    ```json
    {
        "oldPassword": "旧密码",
        "newPassword": "新密码"
    }
    ```
- 响应：`Result<Void>`

### 修改账号 PUT /admin/username

- 请求头：认证
- 请求体（JSON）：
    ```json
    {
        "userName": "管理员新账号"
    }
    ```
- 响应：`Result<Void>`

## 活动生命周期管理

### 概述

- 我们将活动相关的路径以单数资源 `/activity` 为准，支持标准的 CRUD（创建/查询/更新/删除）。
- 后端在查询活动列表时使用 PageHelper 插件处理分页（请求接收 `pageNum` 与 `pageSize`），返回的 `data` 为分页结构（类似 PageInfo）：
  - `data` 示例：
    ```json
    {
      "total": 123,
      "pageNum": 1,
      "pageSize": 10,
      "list": [ /* 活动对象数组 */ ]
    }
    ```

### 创建活动 POST /activity

- 请求头：认证
- 请求体（JSON）：
  ```json
  {
    "activityName": "活动名称",
    "activityDescription": "活动描述（选填）",
    "latitude": 39.12345678,
    "longitude": 116.12345678,
    "location": "位置描述",
    "registrationStart": "2025-10-01T10:00:00",
    "registrationEnd": "2025-10-10T23:59:59",
    "activityStart": "2025-10-20T09:00:00",
    "activityEnd": "2025-10-20T17:00:00",
    "maxParticipants": 200,
    "link": "https://...(选填)"
  }
  ```
- 响应：返回 `Result<Long>`（成功时 `data` 为创建的活动 `id`）

### 查询/搜索活动 GET /activity

- 请求头：认证
- 查询参数（支持过滤与分页）：
  - `activityName`（模糊匹配）
  - `status`（活动状态）
  - `isFull`（是否已满，true/false）
  - `location`（位置模糊）
  - `pageNum`（第几页，默认 1）
  - `pageSize`（每页大小，默认 10）
- 后端说明：使用 PageHelper 插件自动分页，返回 `data` 为分页对象（见上方示例）。
- 前端说明：时间段的查询在前端实现
- 响应为上方的 PageHelper 中的 `data`

### 获取活动详情 GET /activity/{id}

- 请求头：认证
- 响应 `Result<Activity>`（`data` 为活动对象，结构见创建/查询示例）

### 更新活动 PUT /activity/{id}

- 请求头：认证
- 请求体：与创建相同的 JSON（部分字段可选）
- 前端说明：进入页面时自动补全先前活动的信息，需要用到上一个接口
- 响应：`Result<Void>`（成功时 `data` 为 `null`）

### 删除活动 DELETE /activity/{id}

- 请求头：认证
- 响应：`Result<Void>`

### 生成活动二维码 GET /activity/{id}/qrcode

- 参数: `width`、`height`（可选，默认值为300px）
- 响应：`Result<String>`，成功时`data`字段为获得图片的URL。（二维码用于指向活动宣传网页）

## 报名与签到管理

### 概述与设计优化

- 报名表（`registration`）通过 `activity_id` 与 `phone` 唯一索引保证单人对单活动的唯一报名记录；注册成功后会返回报名记录的 `id`。
- 签到流程优先使用二维码触达（签到二维码由服务端生成），扫码后用户进入签到页面或直接携带 registrationId 发起签到确认。后端支持通过 `registrationId` 或 `activityId+phone` 两种方式确认签到。
- 列表查询使用 PageHelper 分页（请求接收 `pageNum`、`pageSize`）。

### 创建报名记录 POST /registration

- 请求头：无需认证
- 请求体（JSON）：
    ```json
    {
        "activityId": 123,
        "registrationName": "张三",
        "college": "计算机学院",
        "phone": "13800001111"
    }
    ```
- 说明：同一活动每个手机号只能报名一次
- 响应：`Result<Void>`，成功时 `data` 为 `null`

### 查询报名记录 GET /registration

- 请求头：认证
- 查询参数（支持过滤与分页）：
  - `phone`（必需）
  - `pageNum`（第几页，默认 1）
  - `pageSize`（每页大小，默认 10）
- 说明：使用 PageHelper 插件自动分页
- 响应：分页对象，结构同活动查询

### 生成报名二维码 GET /registration/{id}/registration/qrcode

- 请求头：无需认证
- 查询参数：
  - `width`（可选，默认 300）
  - `height`（可选，默认 300）
- 响应：`Result<String>`，成功时`data`字段为获得图片的URL。（二维码内容指向报名页）

### 生成签到二维码 GET /registration/{id}/checkin/qrcode

- 请求头：无需认证
- 查询参数：
  - `width`（可选，默认 300）
  - `height`（可选，默认 300）
- 响应：`Result<String>`，成功时`data`字段为获得图片的URL。（二维码内容用于签到）

### 签到确认 POST /registration/checkin

- 请求头：无需认证
- 请求体（JSON）：
    ```json
    {
        "id": 123,
        "phone": "13800001111",
        "latitude": 39.123456,
        "longitude": 116.123456
    }
    ```
- 说明：经后端校验后更新对应报名记录的签到状态
- 响应：`Result<Void>`

## 海报管理

### 查询模板 GET /poster/templates

- 请求头：认证
- 响应：`Result<List<String>>`，成功时 `data` 为模板图片URL列表

### 合成海报 GET /poster/combine

- 请求头：认证
- 查询参数：
  - `templateUrl`（模板图片URL）
  - `qrCodeUrl`（二维码图片URL）
  - `id`（活动ID）
- 响应：`Result<String>`，成功时 `data` 为合成海报的URL

### 查询活动海报 GET /poster

- 请求头：认证
- 查询参数：
  - `id`（活动ID）
- 响应：`Result<List<String>>`，成功时 `data` 为该活动的所有海报URL列表