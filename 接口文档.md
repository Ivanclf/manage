# 接口文档

## 约定

- 若请求头一栏为 `/`，则说明不需要请求头。若请求头一栏为”认证“，则说明需要在请求头封装token数据
- 所有后端成功返回的数据均为以下形式。若无特别说明，后面所指的响应均为`data`中数据的类型。**当响应为`null`时，注意仍要处理`"code"`和`"message"`的内容**
    ```json
    {
        "code": 200,
        "message": "成功消息或错误描述",
        "data": // 具体数据，无数据时为null
    }
    ```
- 所有后端返回失败的数据均为以下格式
    ```json
    {
        "code": "错误状态码",
        "message": "错误原因"
    }
    ```

## 登录与验证

### 登录 `post /admin/login`

- 请求头 `/`
- 请求体 `json`
    ```json
    {
        "id": "管理员id",
        "userName": "管理员账号",
        "password": "管理员密码"
    }
    ```
    前两种类型二选一，看管理员输入什么
- 响应 `null`

### 登出 `post /admin/logout`

- 请求头 认证
- 请求体 `null`
- 响应 `null`

### 验证令牌 `/admin/authorization`

- 请求方法 `get`
- 请求头 认证
- 请求体 `null`
- 响应 `null`

### 改密码 `put /admin/password`

- 请求头 认证
- 请求体 `json`
    ```json
    {
        "oldPassword": "旧密码",
        "newPassword": "新密码"
    }
    ```
- 响应 `null`

### 改账号 `put /admin/username`

- 请求方法 `post`
- 请求头 认证
- 请求体 `json`
    ```json
    {
        "userName": "管理员新账号",
    }
    ```
- 响应 `null`

## 活动生命周期管理

### 创建 `post /activities`

- 请求头 认证
- 请求体 `json`
    ```json
    {
        "activityName": "活动名称",
        "activityDescription": "活动描述（选填）",
        "latitude": "纬度",
        "longitude": "经度",
        "location": "位置描述",
        "registrationStart": "报名开始时间",
        "registrationEnd": "报名结束时间",
        "activityStart": "活动开始时间",
        "activityEnd": "活动结束时间",
        "maxParticipants": "最大报名人数",
        "link": "相关链接（选填）"
    }
    ```
- 响应 `null`

### 查看与搜索 `get /activities`

- 请求头 认证
- 查询参数 `?activityName=活动名称&status=活动状态&isFull=是否已满&location=位置`
- 响应 `list`，存储的是`json`
    ```json
    {
        "id": "活动id",
        "activityName": "活动名称",
        "status": "活动类型",
        "isFull": "是否已满",
        "location": "位置描述",
        "registrationStart": "报名开始时间",
        "registrationEnd": "报名结束时间",
        "activityStart": "活动开始时间",
        "activityEnd": "活动结束时间",
        "maxParticipants": "最大报名人数",
        "currentParticipants": "目前报名人数",
        "creatorId": "创建者id"
    }
    ```

### 获取活动详情 `get /activities/{id}`

- 请求头 认证
- 响应
    ```json
    {
        "id": "活动id",
        "activityName": "活动名称",
        "status": "活动类型",
        "isFull": "是否已满",
        "location": "位置描述",
        "registrationStart": "报名开始时间",
        "registrationEnd": "报名结束时间",
        "activityStart": "活动开始时间",
        "activityEnd": "活动结束时间",
        "maxParticipants": "最大报名人数",
        "currentParticipants": "目前报名人数",
        "creatorId": "创建者id"
    }
    ```

### 生成二维码 `post /activities/{id}/qrcode`

- 请求头 认证
- 响应
    ```json
    {
        "qrcodeUrl": "二维码url"
    }
    ```

### 活动编辑 `put /activities`

- 请求头 认证
- 请求体 `json` 同创建活动
- 响应
    ```json
    {
        "qrcodeUrl": "二维码url"
    }
    ```

### 活动删除 `delete /activities/{id}`

- 请求头 认证
- 响应 `null`

### 签到发放 `post /activities/{id}/checkin-qrcode`

- 请求头 认证
- 响应
    ```json
    {
        "qrcodeUrl": "二维码url"
    }
    ```

### 查看签到人数 `get /activities/{id}/checkin-count`

- 请求头 认证
- 响应
    ```json
    {
        "count": "当前签到人数"
    }
    ```

### (可选)生成海报 `post /activities/{id}/poster`

- 请求头 认证
- 响应
    ```json
    {
        "posterUrl": "海报的url地址"
    }
    ```

### (可选)拼接海报和二维码 `put /activities/{id}/combine`

- 请求头 认证
- 请求体 `json
    ```json
    {
        "qrcodeUrl": "二维码url",
        "posterUrl": "海报url",
        "x": "从左到右的坐标",
        "y": "从上到下的坐标"
    }
    ```
- 响应
    ```json
    {
        "posterUrl": "合成的新海报url坐标"
    }
    ```

## 报名与签到管理

### 参与者报名 `post /registration`

- 请求头 `/`
- 请求体 `json`
    ```json
    {
        "activityId": "活动id",
        "phone": "手机号",
        "registrationName": "姓名",
        "collage": "学院"
    }
    ```
- 响应 `null`

### 查看报名信息 `get /registration`

- 请求头 `/`
- 查询参数 `?phone=手机号`
- 响应 `list`
    ```json
    {
        "id": "活动id",
        "activityName": "活动名称",
        "status": "活动类型",
        "isFull": "是否已满",
        "location": "位置描述",
        "registrationStart": "报名开始时间",
        "registrationEnd": "报名结束时间",
        "activityStart": "活动开始时间",
        "activityEnd": "活动结束时间",
        "maxParticipants": "最大报名人数",
        "currentParticipants": "目前报名人数"
    }
    ```

### 进入签到页面 `get /registration/checkin-page`

- 请求头 `/`
- 查询参数 `?activityId=活动id`
- 响应 
    ```json
    {
        "url": "签到页面URL"
    }
    ```

### 签到确认 `post /registration/checkin`

- 请求头 `/`
- 请求体 `json`
    ```json
    {
        "id": "活动id",
        "phone": "手机号",
        "latitude": "纬度",
        "longitude": "经度"
    }
    ```
- 响应 `null`